<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Chatroom</title>
    <style>
        p {
            margin: 0;
            padding: 0;
        }

        body {
            background-color: lightgray;
        }

        #container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
        }

        #panel {
            margin-top: 5%;
            background-color: white;
            border-radius: 10px;
            width: 50%;
            padding: 50px;
            display: flex;
        }

        #left{
            width: 80%;
        }

        #right{
            width: 20%;
        }

        #msg {
            border: solid 1px black;
            border-radius: 5px;
            height: 300px;
            padding: 10px;
            overflow: scroll;
        }

        button {}

        #input1{
            
            width: 70%;
            font-size: large;
        }

        #sendbtn{
            width: 30%;
            font-size: large;
        }

        #btncontainer{
            width: 100%;
            display: flex;
        }
    </style>
    <script>
        const ws = new WebSocket('ws://localhost:3032');

        let currentName = 'tadokoro';

        ws.onopen = (e) => {
            console.log('ws start')
            ws.send('こんにちは！')
        };

        ws.onmessage = (e) => {
            console.log(e.data);
            const msgdiv = document.querySelector('#msg');
            msgdiv.innerHTML += getmsgDiv(JSON.parse(e.data));
        };

        ws.onclose = (e) => {
            console.log('ws close')
        };

        ws.onerror = (e) => {

        }

        const btn1onclick = () => {
            const input1 = document.querySelector('#input1')
            ws.send(JSON.stringify({
                text: input1.value,
                name: document.querySelector('#input2').value,
                date: new Date().toLocaleString()
            }))
        }

        const btn2onclick = () => {
            currentName = document.querySelector('#input2').value;
        }



        const getmsgDiv = (msg) => {
            return `
            <div style="margin-bottom: 10px;">
                        <p><span style="margin-right: 10px;">${msg.name}</span><span style="color: gray;">${msg.date}</span></p>
                        <p><b>${msg.text}</b></p>
                    </div>
            
            `
        }

    </script>
</head>

</html>

<body>
    <div id="container">
        <div id="panel">
            <div id="left">
                <div id="msg">
                    <!--div style="margin-bottom: 10px;">
                        <p><span style="margin-right: 10px;">az</span><span style="color: gray;">2022-02-22 22:22:22</span></p>
                        <p><b>rua</b></p>
                    </div-->
                    
                </div>
                
                <div id="btncontainer">
    
                    <input id="input1" type="text" value="" />
                    <button id="sendbtn" onclick="btn1onclick()">send</button>
                </div>
            </div>
            <div id="right">

                <input id="input2" type="text" value="tadokoro" />
                <button id="namebtn" onclick="btn2onclick()">set name</button>

            </div>
        </div>

    </div>
</body>